<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.dong.click.ClickDAO">

	<select id="findByDealIdAndUserId"
		resultType="kr.co.dong.click.ClickDTO">
		SELECT
		unique_id, actual_url, category FROM
		dealarm.click_count
		WHERE
		deal_id = #{dealId} AND user_id = #{userId}
	</select>

	<select id="findByUniqueId"
		resultType="kr.co.dong.click.ClickDTO">
		SELECT
		id, unique_id, actual_url, user_id, deal_id, click_count, created_at,
		category FROM
		dealarm.click_count
		WHERE
		unique_id = #{uniqueId}
	</select>

	<insert id="insertLink"
		parameterType="kr.co.dong.click.ClickDTO">
		INSERT INTO dealarm.click_count
		(unique_id, actual_url, user_id, deal_id, click_count, category) VALUES
		(#{uniqueId}, #{actualUrl}, #{userId}, #{dealId}, 0, #{category})
	</insert>

	<update id="increaseClickCount">
		UPDATE dealarm.click_count
		SET
		click_count = click_count + 1
		WHERE
		unique_id = #{uniqueId}
	</update>

	<insert id="insertClickHistory"
		parameterType="kr.co.dong.click.ClickDTO">
		INSERT INTO dealarm.click_history
		(user_id, content_type, content_id, category)
		VALUES
		(#{userId}, 'deal', #{dealId}, #{category})
	</insert>
</mapper>